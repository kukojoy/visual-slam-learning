# 第5讲 相机与图像

### 5.1 针孔相机模型

设相机坐标系下的点$P(X,Y,Z)$成像后为$P'(X',Y',Z')$，并且物理成像平面到小孔的距离为$f$（焦距），那么有
$$
X' = f\frac{X}{Z} \\
Y' = f\frac{Y}{Z}
$$
像素坐标系与成像平面间相差了缩放和原点的平移，则$P'$的像素坐标$[u, v]^T$为
$$
u = \alpha X' + c_x = f_x \frac{X}{Z} + c_x \\
v = \beta Y' + c_y = f_y \frac{Y}{Z} + c_y
$$
即
$$
Z 
\begin{pmatrix}
u \\
v \\
1 \\
\end{pmatrix}

=

\begin{pmatrix}
f_x & 0 & c_x \\
0 & f_y & c_y \\
0 & 0 & 1 \\
\end{pmatrix}
\begin{pmatrix}
X \\
Y \\
Z \\
\end{pmatrix}

\overset{def}{=}

\boldsymbol{KP}
$$
这里矩阵$\boldsymbol{K}$称为相机的**内参数**，内参数在出厂之后是固定的，如果生产商未告知内参，则需要自己确定，称为**标定**。

上式中的$\boldsymbol{P}$是相机坐标系下的坐标，而世界坐标变换到相机坐标的结果由相机的位姿决定，则
$$
Z\boldsymbol{P}_{uv} = Z \begin{bmatrix} u \\ v \\ 1\end{bmatrix}

= \boldsymbol{K}(\boldsymbol{RP}_w + \boldsymbol{t}) = \boldsymbol{KTP}_w
$$
其中，相机的位姿$\boldsymbol{R}, \boldsymbol{t}$又称为相机的**外参数**，会随着相机运动发生改变。

投影的过程还可以看作是对最后一维进行归一化处理，归一化坐标左乘内参就得到了像素坐标，说明点的深度在投影过程中被丢失了。

### 5.2 畸变

现实中相机的结构会引起**畸变**（也称失真）：

径向畸变：由透镜形状引起，主要分为桶形畸变和枕形畸变

切向畸变：由于相机组装无法使透镜和成像面严格平行引起

可以通过畸变系数找到点在像素平面上的正确位置。

### 5.3 总结单目相机的成像过程

1. 世界坐标系下有一个固定的点$P$，世界坐标为$\boldsymbol{P}_w$
2. 由于相机在运动，$P$的相机坐标为$\boldsymbol{P}_c = \boldsymbol{RP}_w + \boldsymbol{t}$
3. 归一化，得到$\boldsymbol{P}_c = [X/Z, Y/Z, 1]^T$ 
4. 有畸变时，根据畸变参数计算$\boldsymbol{P}_c$发生畸变后的坐标
5. 经过内参得到像素坐标$\boldsymbol{P}_{uv} = \boldsymbol{K}\boldsymbol{P}_c$

### 5.4 双目相机模型

双目相机一般可以看作两个水平放置的针孔相机，两者之间的距离称为双目相机的基线（记作b），是双目相机的重要参数。

![image-20241017151833123](C:\Users\48423\AppData\Roaming\Typora\typora-user-images\image-20241017151833123.png)

其中，有
$$
z = \frac{fb}{d}, d \overset{def}{=} u_L - u_R
$$
$d$定义为左右图的横坐标之差，称为视差。根据视察，我们可以估计一个**像素与相机之间的距离**。视差与距离成反比：视差越大，距离越近。同时由于视差最小为一个像素，因此双目相机的深度测量存在一个理论上的最大值，由$fb$确定。

虽然公式很简洁，但是**左图像素和右图像素的对应关系**很难确定，当想计算每一个像素的深度时，计算量和精度都将成为问题。

### 5.5 RGB-D 相机模型

RGB-D相机能够主动测量像素深度。按原理可以分为两大类，1是通过红外结构光原理测量像素距离，2是通过飞行时间原理测量像素距离。

RGB-D相机可自动完成深度图和彩色图像素之间的配对，生成点云，既可以在图像层面进行数据处理，也可以在点云层面处理。

RGB-D相机能够实时测量每个像素点的距离，但是在成本、功耗、使用场景等方面都会受限。